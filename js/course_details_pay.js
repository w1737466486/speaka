"use strict";$(function(){var n,e=location.href,o=location.href.split("?")[1];console.log(o);var t=null,a=null,i=null,s=null,r=null;console.log(e);var c=function(e){for(var o=e.split("?")[1].split("&"),t={},a=0;a<o.length;a++){var i=o[a].split("=");t[i[0]]=i[1]}return t}(e);console.log(c);var p=c.commodity_id,d=c.u_id;"undefined"==d&&(d="");var l=c.joy_from;function y(){var e=navigator.userAgent,o=(navigator.appVersion,-1<e.indexOf("Android")||-1<e.indexOf("Linux"));e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return 1==o}"undefined"==l&&(l=""),n=c.coupon_no,window.get_token=function(e){r=_="Bearer "+e;$.ajax({type:"get",url:"https://api.speaka.live/api/coupon/usable?token="+_+"&id="+p+"&price="+a,async:!1,success:function(e){console.log(e.info.length),1==e.status&&(0!==e.info.length?($(".have").html(e.info.length+" 张可用"),$(".have").css({color:"red"}),$(".have").click(function(){console.log(this),window.location.href="https://h5.speaka.live/front/html/my_coupon_use.html?"+o+"&token="+_+"&id="+p+"&price="+a})):($(".have").html("暂无可用"),$(".have ").css({color:"#888"})))},error:function(e){console.log(e)}}),c.coupon_money&&(11!=c.type_id&&21!=c.type_id||($(".course_pay div").eq(1).find("span").html("实付： ￥"+i.toFixed(2)+"元"),$(".course_pay p").eq(2).css({display:"none"})),12!=c.type_id&&22!=c.type_id||$(".course_pay div").eq(1).find("span").html("实付： ￥"+s.toFixed(2)+"元"),$(".have").html("-￥"+c.coupon_money+"元"))},window.alert=function(e){var o=document.createElement("IFRAME");o.style.display="none",o.setAttribute("src","data:text/plain,"),document.documentElement.appendChild(o),window.frames[0].window.alert(e),o.parentNode.removeChild(o)},$.ajax({type:"get",url:"https://api.speaka.live/api/commodity/"+p,async:!1,success:function(e){console.log(e.pages),$(".course_pay p span").eq(0).html(e.chn+" 微课"),$(".course_pay p span").eq(1).html("￥"+e.price/100+"元"),$(".course_pay p span").eq(2).html("￥"+e.groupon_price/100+"元"),11==c.type_id||21==c.type_id?a=e.price/100:12!=c.type_id&&22!=c.type_id||(a=e.groupon_price/100),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)&&(c.token?$.ajax({type:"get",url:"https://api.speaka.live/api/coupon/usable?token="+c.token+"&id="+p+"&price="+a,async:!1,success:function(e){console.log(e.info.length),1==e.status&&(t="Bearer "+e.token,0!==e.info.length?($(".have").html(e.info.length+" 张可用"),$(".have").css({color:"red"}),$(".have").click(function(){console.log(this),window.location.href="https://h5.speaka.live/front/html/my_coupon_use.html?"+o+"&token="+t+"&id="+p+"&price="+a})):($(".have").html("暂无可用"),$(".have ").css({color:"#888"})))},error:function(e){console.log(e)}}):$.ajax({type:"get",url:"https://api.speaka.live/api/coupon/usable?code="+c.code+"&id="+p+"&price="+a,async:!1,success:function(e){console.log(e.info.length),1==e.status&&(t="Bearer "+e.token,0!==e.info.length?($(".have").html(e.info.length+" 张可用"),$(".have").css({color:"red"}),$(".have").click(function(){console.log(this),window.location.href="https://h5.speaka.live/front/html/my_coupon_use.html?"+o+"&token="+t+"&id="+p+"&price="+a})):($(".have").html("暂无可用"),$(".have ").css({color:"#888"})))},error:function(e){console.log(e)}})),c.coupon_money?(console.log(e.groupon_price/100-Number(c.coupon_money)),11!=c.type_id&&21!=c.type_id||(0<(i=e.price/100-Number(c.coupon_money))||(i=0),$(".course_pay div").eq(1).find("span").html("实付： ￥"+i.toFixed(2)+"元"),$(".course_pay p").eq(2).css({display:"none"})),12!=c.type_id&&22!=c.type_id||(0<(s=e.groupon_price/100-Number(c.coupon_money))||(s=0),$(".course_pay div").eq(1).find("span").html("实付： ￥"+s.toFixed(2)+"元")),$(".have").html("-￥"+c.coupon_money+"元")):(11!=c.type_id&&21!=c.type_id||($(".course_pay div").eq(1).find("span").html("实付： ￥"+e.price/100+"元"),$(".course_pay p").eq(2).css({display:"none"})),12!=c.type_id&&22!=c.type_id||$(".course_pay div").eq(1).find("span").html("实付： ￥"+e.groupon_price/100+"元")),11!=c.type_id&&12!=c.type_id||$(".wx_stutas").css({display:"none"})}});var _=null;if(11==c.type_id||12==c.type_id){var u=null;11==c.type_id&&(u=0),12==c.type_id&&(u=1),$(".wx_pay span").eq(1).click(function(){$.ajax({type:"post",url:"https://api.speaka.live/api/order/insertOrder",async:!0,dataType:"JSON",data:{commodity_id:p,type_id:u,pay_type:0,from_type:0,order_no:c.order_no,coupon_no:n,u_id:d,joy_from:l,location:window.location.href},beforeSend:function(e){e.setRequestHeader("Authorization",t)},success:function(o){console.log(o.data.config),200==o.code?(wx.config({debug:o.data.config.debug,appId:o.data.config.appId,timestamp:o.data.config.timestamp,nonceStr:o.data.config.nonceStr,signature:o.data.config.signature,jsApiList:o.data.config.jsApiList}),wx.ready(function(){wx.chooseWXPay({timestamp:o.data.pay_config.timestamp,nonceStr:o.data.pay_config.nonceStr,package:o.data.pay_config.package,signType:o.data.pay_config.signType,paySign:o.data.pay_config.paySign,success:function(e){11==c.type_id&&($(".course_pay>div").remove(),$(".course_progress span").eq(0).find("i").eq(0).find("img").attr("src","../img/pay_success.png"),$(".course_progress span").eq(0).find("i").eq(1).html('<img src="../img/pay_success.png"/>'),$(".course_progress span").eq(0).find("i").eq(2).html('<img src="../img/pay_click.png"/>'),$(".course_progress span").eq(1).find("i").eq(0).html("支付成功"),$(".course_progress span").eq(1).find("i").eq(1).html("  "),$(".only_pay").show(),$(".only_pay span").click(function(){window.webkit?window.location.href="https://itunes.apple.com/cn/app/speak-a/id1345905287":window.location.href="https://www.pgyer.com/q8oQ"})),12==c.type_id&&(window.location.href="https://h5.speaka.live/front/html/group_pay.html?commodity_id="+p+"&order_no="+o.data.order_no+"&joy_from="+l+"&is_pay=success")}})}),wx.error(function(e){$(".course_progress span").eq(0).find("i").eq(0).find("img").attr("src","../img/pay_error.png"),$(".course_progress span").eq(1).find("i").eq(0).html("支付失败"),$(".wx_pay span").eq(1).find("b").html("重新支付"),console.log(e)}),wx.checkJsApi({jsApiList:["chooseImage"],success:function(e){}})):(201==o.code&&(11==c.type_id&&($(".course_pay>div").remove(),$(".course_progress span").eq(0).find("i").eq(0).find("img").attr("src","../img/pay_success.png"),$(".course_progress span").eq(0).find("i").eq(1).html('<img src="../img/pay_success.png"/>'),$(".course_progress span").eq(0).find("i").eq(2).html('<img src="../img/pay_click.png"/>'),$(".course_progress span").eq(1).find("i").eq(0).html("支付成功"),$(".course_progress span").eq(1).find("i").eq(1).html("  "),$(".only_pay").show(),$(".only_pay span").click(function(){window.webkit?window.location.href="https://itunes.apple.com/cn/app/speak-a/id1345905287":window.location.href="https://www.pgyer.com/q8oQ"})),12==c.type_id&&(window.location.href="https://h5.speaka.live/front/html/group_pay.html?commodity_id="+p+"&order_no="+o.data.order_no+"&joy_from="+l+"&is_pay=success")),401==o.code&&alert("课程状态异常！"),402==o.code&&alert("课程已下架！"),403==o.code&&alert("课程已经卖完啦！"),404==o.code&&alert("订单支付方式错误！"),405==o.code&&alert("来源非法！"),406==o.code&&alert("订单类型非法！"),410==o.code&&alert("您已经参团了！"),411==o.code&&alert("当前url非法！"),412==o.code&&alert("优惠券id错误！"),413==o.code&&alert("推荐人非法！"),414==o.code&&alert("当前课程不能使用该优惠券！"),415==o.code&&alert("该优惠券还未到使用时间！"),416==o.code&&alert("该优惠券已经过期！"),417==o.code&&alert("该优惠券已经使用过啦！"),418==o.code&&alert("该优惠券状态异常！"),419==o.code&&alert("该优惠券未到达使用金额！"),420==o.code&&alert("下单失败请重试！"),422==o.code&&alert("余额不足！"),423==o.code&&alert("当前课程不允许开团！"),424==o.code&&alert("你已经购过该课程，请勿重复购买！"),425==o.code&&alert("该课程购买时间已过！"))}})})}else $(".wx_pay span").eq(1).click(function(){if(21==c.type_id&&(u=0),22==c.type_id&&(u=1),21==c.type_id)if(y()){var e={typeId:0,paytypeId:1,paycallback:"get_token",title:"超有趣的少儿互动英文课！",desc:"Youtube英文教育红人家庭中国首秀，台湾帅气老师Lyle担当讲解。欢乐体验美国地道家庭生活"};e.share_url="https://h5.speaka.live/front/html/course_details.html?commodity_id="+p+"&joy_from="+l,androidpay.androidWechatPay(JSON.stringify(e))}else{var o={typeId:0,paytypeId:1,paycallback:"get_token",title:"超有趣的少儿互动英文课！",desc:"Youtube英文教育红人家庭中国首秀，台湾帅气老师Lyle担当讲解。欢乐体验美国地道家庭生活"};o.share_url="https://h5.speaka.live/front/html/course_details.html?commodity_id="+p+"&joy_from="+l,window.webkit.messageHandlers.payClick.postMessage(JSON.stringify(o))}else if(22==c.type_id)if(y()){var t={typeId:1,paytypeId:1,paycallback:"get_token",title:"【三人成团】！超有趣的少儿互动英文课！",desc:"Youtube英文教育红人家庭中国首秀，台湾帅气老师Lyle担当讲解。欢乐体验美国地道家庭生活!"};t.share_url="https://h5.speaka.live/front/html/group_pay.html?commodity_id="+p+"&joy_from="+l,androidpay.androidWechatPay(JSON.stringify(t))}else{var a={typeId:1,paytypeId:1,paycallback:"get_token",title:"【三人成团】！超有趣的少儿互动英文课！",desc:"Youtube英文教育红人家庭中国首秀，台湾帅气老师Lyle担当讲解。欢乐体验美国地道家庭生活!"};a.share_url="https://h5.speaka.live/front/html/group_pay.html?commodity_id="+p+"&joy_from="+l,window.webkit.messageHandlers.payClick.postMessage(JSON.stringify(a))}var i=null;i=y()?2:1,$.ajax({type:"post",url:"https://api.speaka.live/api/order/insertOrder",data:{commodity_id:p,type_id:u,pay_type:0,coupon_no:n,from_type:i,joy_from:l,location:window.location.href},beforeSend:function(e){e.setRequestHeader("Authorization",r)},dataType:"JSON",async:!1,success:function(e){if(200==e.code){var o={paytypeId:2};o.partnerid=e.data.pay_config.partnerid,o.prepayid=e.data.pay_config.prepayid,o.package=e.data.pay_config.package,o.noncestr=e.data.pay_config.noncestr,o.timestamp=e.data.pay_config.timestamp,o.sign=e.data.pay_config.sign,o.order_no=e.data.order_no,y()?androidpay.androidWechatPay(JSON.stringify(o)):window.webkit.messageHandlers.payData.postMessage(JSON.stringify(o))}else 201==e.code&&($(".course_pay_success").show(),21==c.type_id&&($(".course_pay>div").remove(),$(".course_progress span").eq(0).find("i").eq(0).find("img").attr("src","../img/pay_success.png"),$(".course_progress span").eq(0).find("i").eq(1).html('<img src="../img/pay_success.png"/>'),$(".course_progress span").eq(0).find("i").eq(2).html('<img src="../img/pay_click.png"/>'),$(".course_progress span").eq(1).find("i").eq(0).html("支付成功"),$(".course_progress span").eq(1).find("i").eq(1).html("  "),$(".only_pay").show(),$(".only_pay span").click(function(){window.webkit?window.location.href="https://itunes.apple.com/cn/app/speak-a/id1345905287":window.location.href="https://www.pgyer.com/q8oQ"})),22==c.type_id&&(window.location.href="https://h5.speaka.live/front/html/group_pay.html?commodity_id="+p+"&order_no="+e.data.order_no+"&joy_from="+l+"&is_pay=success")),401==e.code&&alert("课程状态异常！"),402==e.code&&alert("课程已下架！"),403==e.code&&alert("课程已经卖完啦！"),404==e.code&&alert("订单支付方式错误！"),405==e.code&&alert("来源非法！"),406==e.code&&alert("订单类型非法！"),410==e.code&&alert("您已经参团了！"),411==e.code&&alert("当前url非法！"),412==e.code&&alert("优惠券id错误！"),413==e.code&&alert("推荐人非法！"),414==e.code&&alert("当前课程不能使用该优惠券！"),415==e.code&&alert("该优惠券还未到使用时间！"),416==e.code&&alert("该优惠券已经过期！"),417==e.code&&alert("该优惠券已经使用过啦！"),418==e.code&&alert("该优惠券状态异常！"),419==e.code&&alert("该优惠券未到达使用金额！"),420==e.code&&alert("下单失败请重试！"),422==e.code&&alert("余额不足！"),423==e.code&&alert("当前课程不允许开团！"),424==e.code&&alert("你已经购过该课程，请勿重复购买！"),425==e.code&&alert("该课程购买时间已过！")},error:function(e){alert(JSON.stringify(e))}})});$(".wx_pay span").eq(0).click(function(){window.location.href="https://h5.speaka.live/front/html/course_details.html?commodity_id="+p+"&joy_from="+l})});