"use strict";$(function(){var e,t=function(e){for(var t=e.split("?")[1].split("&"),o={},s=0;s<t.length;s++){var i=t[s].split("=");o[i[0]]=i[1]}return o}(location.href),o=t.code,h=null,m=t.commodity_id;console.log(m);var v=null,f=t.joy_from,g=t.u_id,s=!0,i=null;g&&"undefined"!=g&&($(".share_dec").css({right:"0px"}),$.ajax({type:"get",url:"https://api.speaka.live/api/u/head",data:{id:g},async:!0,success:function(e){console.log(e),200==e.code?(null==e.data[g].head_wx&&""!=e.data[g].head?$(".share_wxhead img").attr("src","https://s.speaka.live/"+e.data[g].head):null!=e.data[g].head_wx?$(".share_wxhead img").attr("src",e.data[g].head_wx):$(".share_wxhead img").attr("src","../img/mr.png"),$(".share_dec p b").eq(1).html(e.data[g].name)):$(".share_dec").hide()},error:function(e){console.log(e)}})),$(".share_dec").click(function(){s?($(".share_dec").css({right:"-80px"}),s=!1):($(".share_dec").css({right:"0px"}),s=!0)}),y()&&(o?$.ajax({type:"get",url:"https://api.speaka.live/api/commoditybuy/"+m+"?code="+o,async:!1,success:function(e){console.log(e),v=e.token,i=e.now_uid,e.token?(h=e.token,v=e.token):window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx0b778a82184cf52f&redirect_uri="+encodeURI(location.href.split("?")[0]+"?commodity_id="+m)+"%26u_id="+g+"%26joy_from="+f+"&response_type=code&scope=snsapi_userinfo&state=1#wechat_redirect"},error:function(e){console.log(e)}}):window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx0b778a82184cf52f&redirect_uri="+encodeURI(location.href.split("?")[0]+"?commodity_id="+m)+"%26u_id="+g+"%26joy_from="+f+"&response_type=code&scope=snsapi_userinfo&state=1#wechat_redirect"),window.alert=function(e){var t=document.createElement("IFRAME");t.style.display="none",t.setAttribute("src","data:text/plain,"),document.documentElement.appendChild(t),window.frames[0].window.alert(e),t.parentNode.removeChild(t)},window.get_share=function(e){var t={title:"【推荐2人免费学】跟着美国家庭学英语，看世界!",desc:"Youtube网红家庭中国首秀，台湾帅气老师Lyle实时互动讲解，趣味练习巩固效果。"};t.share_url=location.href,window.webkit?window.webkit.messageHandlers.shareClick.postMessage(JSON.stringify(t)):androidCorsonShare.CorsonShare(JSON.stringify(t))};var a=!0;function y(){return"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}console.log(t),e="https://api.speaka.live/api/commodity/"+m,console.log(e),$.ajax({type:"get",url:e,async:!0,success:function(e){if("{}"!=JSON.stringify(e)){console.log(e),$(".v_nav .v_s1").html(e.eng),$(".v_nav .v_s2").html(e.chn),$(".v_nav .nav_video").attr("src","https://s.speaka.live/"+e.pic_path),$(".course_nav p").eq(0).html("课程详情<b></b>"),$(".course_nav p").eq(1).html("团购须知<b></b>");for(var t=0;t<e.pages.length;t++)1==e.pages[t].type&&$(".v_img").append('<div class="img_video" width="100%"><video controls="true" poster="https://s.speaka.live/'+e.pages[t].pic_path+'" controlslist="nodownload" width="100%" src="https://s.speaka.live/'+e.pages[t].video_path+'"></video><img src="../img/Play.png"/></div> '),0==e.pages[t].type&&$(".v_img").append('<img src="https://s.speaka.live/'+e.pages[t].pic_path+'"/>');$(".v_img img").eq(0).click(function(){$(".course_nav p").eq(1).find("b").css({display:"block"}),$(".v_img").css({display:"none"}),$(".course_nav p").eq(0).find("b").css({display:"none"}),$(".v_QA").css({display:"block"})});var o=!0;$(".img_video").click(function(){o?(o=!1,$(this).find("video").trigger("play"),$(this).find("img").remove()):(o=!0,$(this).find("video").trigger("pause"),$(this).append('<img src="../img/Play.png"/>'))}),$(".v_det .v_det_s1").html("开课时间："+e.begin_time.substr(0,10)),$(".v_det .v_det_s2").html("课程时长："+e.last_days+"天");var s=new Date(e.begin_time.substr(0,10));s=s.valueOf()-2592e5;var i=(_=new Date(s)).getFullYear()+"-"+(_.getMonth()+1<10?"0"+(_.getMonth()+1):_.getMonth()+1)+"-"+_.getDate()+" "+_.getHours()+":"+_.getMinutes()+":"+_.getSeconds();$(".v_det .v_det_s3").html("购买截止时间："+i.substr(0,10)),$(".v_footer .v_pay span").eq(0).html("<div>¥"+e.price/100+"</div><b>单人购</b>"),$(".v_footer .v_pay span").eq(1).html("<div>¥"+e.groupon_price/100+"</div><b>开团</b>"),$.ajax({type:"get",url:"https://api.speaka.live/api/commoditybuy/"+m+"?token=Bearer "+h,async:!1,success:function(e){console.log(e),403!=e.code&&404!=e.code&&405!=e.code||($(".v_footer").hide(),$(".buy_success").show(),$(".buy_success .buy_pay p").eq(0).click(function(){window.location.href="https://h5.speaka.live/front/html/my_order.html?token="+v}),$(".buy_success .buy_pay p").eq(1).click(function(){window.webkit?window.location.href="https://itunes.apple.com/cn/app/speak-a/id1345905287":window.location.href="https://www.pgyer.com/q8oQ"}))},error:function(e){console.log(e)}});var a=(c=new Date,r=c.getMonth()+1,p=c.getDate(),l=c.getHours(),d=c.getMinutes(),u=c.getSeconds(),1<=r&&r<=9&&(r="0"+r),0<=p&&p<=9&&(p="0"+p),0<=l&&l<=9&&(l="0"+l),0<=d&&d<=9&&(d="0"+d),0<=u&&u<=9&&(u="0"+u),c.getFullYear()+"-"+r+"-"+p+" "+l+":"+d+":"+u),n=i;a=a.substr(0,4)+"/"+a.substr(5,2)+"/"+a.substr(8,2)+" "+a.substr(11),n=n.substr(0,4)+"/"+n.substr(5,2)+"/"+n.substr(8,2)+" "+n.substr(11),a=new Date(a).valueOf(),((n=new Date(n).valueOf())-a)/1e3<=0?($(".v_pay p").eq(0).click(function(){alert("记得来早点，亲！购买时间已经过了哦！")}),$(".v_pay p").eq(1).click(function(){alert("记得来早点，亲！购买时间已经过了哦！")})):($(".v_pay p").eq(0).click(function(){y()?window.location.href="https://api.speaka.live/api/order/buy/"+m+"?type_id=11&commodity_id="+m+"&joy_from="+f:window.location.href="https://h5.speaka.live/front/html/course_details_pay.html?type_id=21&commodity_id="+m+"&joy_from="+f}),y()?$(".v_pay p").eq(1).click(function(){window.location.href="https://api.speaka.live/api/order/buy/"+m+"?type_id=12&commodity_id="+m+"&u_id="+g+"&joy_from="+f}):$(".v_pay p").eq(1).click(function(){window.location.href="https://h5.speaka.live/front/html/course_details_pay.html?type_id=22&commodity_id="+m+"&u_id="+g+"&joy_from="+f}))}else alert("该商品不存在，请重试！");var c,r,p,l,d,u,_}}),setInterval(function(){var e=document.documentElement.scrollTop||document.body.scrollTop;$(".course_nav").offset().top;$(".nav_video").height()<e?($(".course_nav").css({position:"fixed"}),$(".v_img").css({"margin-top":"44px"}),$(".v_QA span").css({height:"44px"})):($(".course_nav").css({position:"relative"}),$(".v_img").css({"margin-top":"0"}),$(".v_QA span").css({height:"0px"})),50<e&&$(".v_footer").css({opacity:"0.4",display:"block"}),150<e&&$(".v_footer").css({opacity:"0.6"}),250<e&&$(".v_footer").css({opacity:"1"}),e<50&&$(".v_footer").css({opacity:"0",display:"none"}),450<e&&$(".v_wx").css({opacity:"0.5"}),750<e&&$(".v_wx").css({opacity:"0.3"}),900<e&&$(".v_wx").css({opacity:"0"}),e<750&&$(".v_wx").css({opacity:"1"})},50),setInterval(function(){0==(document.documentElement.scrollTop||document.body.scrollTop)?($(".v_nav .slip_up").css({display:"block"}),(a=!a)?$(".v_nav .slip_up").css({bottom:"45px"}):$(".v_nav .slip_up").css({bottom:"60px"})):$(".v_nav .slip_up").css({display:"none"})},500),y()&&$.post("https://api.speaka.live/api/weChat/wxconfig",{location:window.location.href},function(e){console.log(e),1==e.status?(wx.config({debug:e.config.debug,appId:e.config.appId,timestamp:e.config.timestamp,nonceStr:e.config.nonceStr,signature:e.config.signature,jsApiList:e.config.jsApiList}),wx.ready(function(){wx.onMenuShareAppMessage({title:"【推荐2人免费学】跟着美国家庭学英语，看世界！",desc:"Youtube网红家庭中国首秀，台湾帅气老师Lyle实时互动讲解，趣味练习巩固效果。",link:"https://h5.speaka.live/front/html/course_details.html?commodity_id="+m+"&u_id="+i+"&joy_from="+f,imgUrl:"https://s.speaka.live/static/logo-white.png",type:"",dataUrl:"",success:function(){window.location.href="https://h5.speaka.live/front/html/course_details.html?commodity_id="+m+"&u_id="+i+"&joy_from="+f},cancel:function(){window.location.href="https://h5.speaka.live/front/html/course_details.html?commodity_id="+m+"&u_id="+i+"&joy_from="+f}}),wx.onMenuShareTimeline({title:"【6~12岁英文微课】跟着美国家庭学英语，看世界！",link:"https://h5.speaka.live/front/html/course_details.html?commodity_id="+m+"&u_id="+i+"&joy_from="+f,imgUrl:"https://s.speaka.live/static/logo-white.png",success:function(){window.location.href="https://h5.speaka.live/front/html/course_details.html?commodity_id="+m+"&u_id="+i+"&joy_from="+f},cancel:function(){window.location.href="https://h5.speaka.live/front/html/course_details.html?commodity_id="+m+"&u_id="+i+"&joy_from="+f}})}),wx.error(function(e){}),wx.checkJsApi({jsApiList:["chooseImage"],success:function(e){}})):alert("验证信息已失效，请重新获取订单信息！")},"json"),$(".course_nav p").eq(1).click(function(){$(".course_nav p").eq(1).find("b").css({display:"block"}),$(".v_img").css({display:"none"}),$(".course_nav p").eq(0).find("b").css({display:"none"}),$(".v_QA").css({display:"block"})}),$(".course_nav p").eq(0).click(function(){$(".course_nav p").eq(1).find("b").css({display:"none"}),$(".v_img").css({display:"block"}),$(".course_nav p").eq(0).find("b").css({display:"block"}),$(".v_QA").css({display:"none"})})});