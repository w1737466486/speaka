"use strict";$(function(){var p=function(e){for(var o=e.split("?")[1].split("&"),t={},s=0;s<o.length;s++){var i=o[s].split("=");t[i[0]]=i[1]}return t}(location.href),o=p.order_no,e=p.code;console.log(e);var u=null,c=p.u_id,t=null,h=p.commodity_id,d=p.joy_from,s=!0,l="【推荐2人免费学】";function _(){var e=new Date,o=e.getMonth()+1,t=e.getDate(),s=e.getHours(),i=e.getMinutes(),n=e.getSeconds();return 1<=o&&o<=9&&(o="0"+o),0<=t&&t<=9&&(t="0"+t),0<=s&&s<=9&&(s="0"+s),0<=i&&i<=9&&(i="0"+i),0<=n&&n<=9&&(n="0"+n),e.getFullYear()+"-"+o+"-"+t+" "+s+":"+i+":"+n}p.is_pay?$("html").css({height:"100%"}):$("#course_progress").hide(),$("title").html("少儿英语微课首发优惠"),c&&"undefined"!=c&&($(".share_dec").css({right:"0px"}),$.ajax({type:"get",url:"https://api.speaka.live/api/u/head",data:{id:c},async:!0,success:function(e){console.log(e),200==e.code?(null==e.data[c].head_wx&&""!=e.data[c].head?$(".share_wxhead img").attr("src","https://s.speaka.live/"+e.data[c].head):null!=e.data[c].head_wx?$(".share_wxhead img").attr("src",e.data[c].head_wx):$(".share_wxhead img").attr("src","../img/mr.png"),$(".share_dec p b").eq(1).html(e.data[c].name)):$(".share_dec").hide()},error:function(e){console.log(e)}})),$(".share_dec").click(function(){s?($(".share_dec").css({right:"-80px"}),s=!1):($(".share_dec").css({right:"0px"}),s=!0)}),setInterval(function(){var e=document.documentElement.scrollTop||document.body.scrollTop;$(".v_nav").offset().top+$(".v_nav").height()<e?($(".course_nav").css({position:"fixed"}),$(".v_img").css({"margin-top":"44px"}),$(".v_QA").css({"padding-top":"44px"})):($(".course_nav").css({position:"relative"}),$(".v_img").css({"margin-top":"0"}),$(".v_QA").css({"padding-top":"0"})),450<e&&$(".v_wx").css({opacity:"0.5"}),750<e&&$(".v_wx").css({opacity:"0.3"}),900<e&&$(".v_wx").css({opacity:"0"}),e<750&&$(".v_wx").css({opacity:"1"})},50),"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)&&(e?$.ajax({type:"get",url:"https://api.speaka.live/api/commoditybuy/"+h+"?code="+e,async:!1,success:function(e){t=e.now_uid,console.log(e),e.token?u=e.token:window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx0b778a82184cf52f&redirect_uri="+encodeURI(location.href.split("?")[0]+"?commodity_id="+h)+"%26joy_from="+d+"%26order_no="+o+"%26u_id="+c+"&response_type=code&scope=snsapi_userinfo&state=1#wechat_redirect"},error:function(e){console.log(e)}}):window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx0b778a82184cf52f&redirect_uri="+encodeURI(location.href.split("?")[0]+"?commodity_id="+h)+"%26joy_from="+d+"%26order_no="+o+"%26u_id="+c+"&response_type=code&scope=snsapi_userinfo&state=1#wechat_redirect"),1==p.is_share&&($(".group_share").show(),$(".group_share").click(function(){$(".group_share").hide()})),$(".group_share").click(function(){$(".group_share").hide()}),window.alert=function(e){var o=document.createElement("IFRAME");o.style.display="none",o.setAttribute("src","data:text/plain,"),document.documentElement.appendChild(o),window.frames[0].window.alert(e),o.parentNode.removeChild(o)},$.ajax({type:"get",url:"https://api.speaka.live/api/commodity/"+h,async:!0,success:function(e){console.log(e),$(".v_nav .v_s1").html(e.eng),$(".v_nav .v_s2").html(e.chn),$(".v_nav>img").attr("src","https://s.speaka.live/"+e.pic_path),$(".course_nav p").eq(0).html("课程详情<b></b>"),$(".course_nav p").eq(1).html("团购须知<b></b>");for(var o=0;o<e.pages.length;o++)1==e.pages[o].type&&$(".v_img").append('<div class="img_video" width="100%"><video controls="true" poster="https://s.speaka.live/'+e.pages[o].pic_path+'" controlslist="nodownload" width="100%" src="https://s.speaka.live/'+e.pages[o].video_path+'"></video><img src="../img/Play.png"/></div> '),0==e.pages[o].type&&$(".v_img").append('<img src="https://s.speaka.live/'+e.pages[o].pic_path+'"/>');$(".v_img img").eq(0).click(function(){$(".course_nav p").eq(1).find("b").css({display:"block"}),$(".v_img").css({display:"none"}),$(".course_nav p").eq(0).find("b").css({display:"none"}),$(".v_QA").css({display:"block"})});var t=!0;$(".img_video").click(function(){t?(t=!1,$(this).find("video").trigger("play"),$(this).find("img").remove()):(t=!0,$(this).find("video").trigger("pause"),$(this).append('<img src="../img/Play.png"/>'))}),$(".v_det .v_det_s1").html("开课时间："+e.begin_time.substr(0,10)),$(".v_det .v_det_s2").html("课程时长："+e.last_days+"天");var s=new Date(e.begin_time.substr(0,10));s=s.valueOf()-2592e5;var i,n,r,a,p,c,d,l=(i=new Date(s),n=i.getFullYear()+"-",r=(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-",a=i.getDate()+" ",p=i.getHours()+":",c=i.getMinutes()+":",d=i.getSeconds(),n+r+a+p+c+d);$(".v_det .v_det_s3").html("购买截止时间："+l.substr(0,10)),$(".group_foot p span").eq(0).html("开团"),$(".group_foot p span").eq(1).html("<div>¥"+e.groupon_price/100+"</div><b>参团</b>"),$.ajax({type:"get",url:"https://api.speaka.live/api/commoditybuy/"+h+"?token=Bearer "+u,async:!1,success:function(e){console.log(e),403==e.code||404==e.code||405==e.code?($("#course_progress").show(),$("html").css({height:"100%"}),$(".group_foot").hide(),$(".buy_success").show(),$(".buy_success .buy_pay p").eq(0).click(function(){window.webkit?window.location.href="https://itunes.apple.com/cn/app/speak-a/id1345905287":window.location.href="https://www.pgyer.com/q8oQ"}),$(".buy_success .buy_pay p").eq(1).click(function(){$(".group_share").show()})):$("#course_progress").hide()},error:function(e){console.log(e)}});e.price,e.groupon_price},error:function(e){console.log(e)}}),$.ajax({type:"get",url:"https://api.speaka.live/api/order_group/"+p.order_no,async:!0,success:function(r){if(console.log(r),0<r.group.length){$(".group_member li");for(var e=0;e<r.group.length;e++)null==r.group[e].user_info.head_wx&&""!=r.group[e].user_info.head?$(".group_member li").eq(e).find("img").eq(1).attr("src","https://s.speaka.live/"+r.group[e].user_info.head):null!=r.group[e].user_info.head_wx?$(".group_member li").eq(e).find("img").eq(1).attr("src",r.group[e].user_info.head_wx):$(".group_member li").eq(e).find("img").eq(1).attr("src","../img/mr.png"),$(".group_member li").eq(e).find("b").html(r.group[e].user_info.name);c&&"undefined"!=c||(c=r.group[0].u_id)}var o=_(),t=r.limit_at;o=o.substr(0,4)+"/"+o.substr(5,2)+"/"+o.substr(8,2)+" "+o.substr(11),t=t.substr(0,4)+"/"+t.substr(5,2)+"/"+t.substr(8,2)+" "+t.substr(11),o=new Date(o).valueOf();var s=(t=new Date(t).valueOf())/1e3-o/1e3;console.log(s);var i=Math.floor(s/3600);console.log(i);var n=Math.floor((s-3600*i)/60);console.log(n);var a=Math.floor(s-3600*i-60*n);console.log(a),$(".group_head p").eq(1).find("span").eq(0).html(i),$(".group_head p").eq(1).find("span").eq(1).html(n),$(".group_head p").eq(1).find("span").eq(2).html(a),0<s&&3<=r.group.length?($(".group_head p").eq(0).html("该拼团已成团！"),$(".group_head p").eq(1).html("剩余分班时间<span></span>时<span></span>分<span></span>秒！"),$(".group_foot p").eq(1).click(function(){alert("该团人数已满！去开团"),window.location.href="https://api.speaka.live/api/order/buy/"+h+"?type_id=12&commodity_id="+h+"&u_id="+c+"&joy_from="+d})):s<=0&&r.group.length<3?($(".group_head p").eq(0).html("拼团已结束！"),$(".group_head p").eq(1).find("span").eq(0).html("00"),$(".group_head p").eq(1).find("span").eq(1).html("00"),$(".group_head p").eq(1).find("span").eq(2).html("00"),$(".group_foot p").eq(1).css({cursor:"default",opacity:"0.2"})):s<=0&&($(".group_head p").eq(0).html("该拼团已结束"),$(".group_head p").eq(1).find("span").eq(0).html("00"),$(".group_head p").eq(1).find("span").eq(1).html("00"),$(".group_head p").eq(1).find("span").eq(2).html("00"),$(".group_foot p").eq(1).css({cursor:"default",opacity:"0.2"})),0<s&&1==r.group.length&&($(".group_head p").eq(0).html("还差<i>2</i>人成团"),l="【差2人成团】"),0<s&&2==r.group.length&&($(".group_head p").eq(0).html("还差<i>1</i>人成团"),l="【差1人成团】"),setInterval(function(){var e=_(),o=r.limit_at;e=e.substr(0,4)+"/"+e.substr(5,2)+"/"+e.substr(8,2)+" "+e.substr(11),o=o.substr(0,4)+"/"+o.substr(5,2)+"/"+o.substr(8,2)+" "+o.substr(11),e=new Date(e).valueOf();var t=(o=new Date(o).valueOf())/1e3-e/1e3,s=Math.floor(t/3600),i=Math.floor((t-3600*s)/60),n=Math.floor(t-3600*s-60*i);$(".group_head p").eq(1).find("span").eq(0).html(s),$(".group_head p").eq(1).find("span").eq(1).html(i),$(".group_head p").eq(1).find("span").eq(2).html(n),0<t&&3<=r.group.length?$(".group_head p").eq(0).html("该拼团已成团！"):t<=0&&r.group.length<3?($(".group_head p").eq(0).html("该拼团已结束！"),$(".group_head p").eq(1).find("span").eq(0).html("00"),$(".group_head p").eq(1).find("span").eq(1).html("00"),$(".group_head p").eq(1).find("span").eq(2).html("00"),$(".group_foot p").eq(1).css({cursor:"default",opacity:"0.2"})):t<=0&&($(".group_head p").eq(0).html("该拼团已结束"),$(".group_head p").eq(1).find("span").eq(0).html("00"),$(".group_head p").eq(1).find("span").eq(1).html("00"),$(".group_head p").eq(1).find("span").eq(2).html("00"),$(".group_foot p").eq(1).css({cursor:"default",opacity:"0.2"})),0<t&&1==r.group.length&&$(".group_head p").eq(0).html("还差<i>2</i>人成团"),0<t&&2==r.group.length&&$(".group_head p").eq(0).html("还差<i>1</i>人成团"),0<t&&r.group.length<3&&$(".group_foot p").eq(1).click(function(){window.location.href="https://api.speaka.live/api/order/buy/"+h+"?type_id=12&commodity_id="+h+"&order_no="+p.order_no+"&u_id="+c+"&joy_from="+d})},1e3)},error:function(e){console.log(e)}}),$.post("https://api.speaka.live/api/weChat/wxconfig",{location:window.location.href},function(e){console.log(e),1==e.status?(wx.config({debug:e.config.debug,appId:e.config.appId,timestamp:e.config.timestamp,nonceStr:e.config.nonceStr,signature:e.config.signature,jsApiList:e.config.jsApiList}),wx.ready(function(){wx.hideMenuItems({menuList:["menuItem:copyUrl"]}),wx.onMenuShareAppMessage({title:l+"跟着美国家庭学英语，看世界！",desc:"Youtube网红家庭中国首秀，台湾帅气老师Lyle实时互动讲解，趣味练习巩固效果。",link:"https://h5.speaka.live/front/html/group_pay.html?commodity_id="+h+"&order_no="+p.order_no+"&u_id="+t+"&joy_from="+d,imgUrl:"https://s.speaka.live/static/logo-white.png",type:"",dataUrl:"",success:function(){window.location.href="https://h5.speaka.live/front/html/group_pay.html?commodity_id="+h+"&order_no="+p.order_no+"&u_id="+t+"&joy_from="+d},cancel:function(){window.location.href="https://h5.speaka.live/front/html/group_pay.html?commodity_id="+h+"&order_no="+p.order_no+"&joy_from="+d}}),wx.onMenuShareTimeline({title:l+"跟着美国家庭学英语，看世界！",link:"https://h5.speaka.live/front/html/group_pay.html?commodity_id="+h+"&order_no="+p.order_no+"&u_id="+t+"&joy_from="+d,imgUrl:"https://s.speaka.live/static/logo-white.png",success:function(){window.location.href="https://h5.speaka.live/front/html/group_pay.html?commodity_id="+h+"&order_no="+p.order_no+"&u_id="+t+"&joy_from="+d},cancel:function(){window.location.href="https://h5.speaka.live/front/html/group_pay.html?commodity_id="+h+"&order_no="+p.order_no+"&joy_from="+d}})}),wx.error(function(e){console.log(JSON.stringify(e))}),wx.checkJsApi({jsApiList:["chooseImage"],success:function(e){}})):alert("验证信息已失效，请重新获取订单信息！")},"json"),$(".group_foot p").eq(0).click(function(){window.location.href="https://api.speaka.live/api/order/buy/"+h+"?type_id=12&commodity_id="+h+"&u_id="+c+"&joy_from="+d}),$(".course_nav p").eq(1).click(function(){$(".course_nav p").eq(1).find("b").css({display:"block"}),$(".v_img").css({display:"none"}),$(".course_nav p").eq(0).find("b").css({display:"none"}),$(".v_QA").css({display:"block"})}),$(".course_nav p").eq(0).click(function(){$(".course_nav p").eq(1).find("b").css({display:"none"}),$(".v_img").css({display:"block"}),$(".course_nav p").eq(0).find("b").css({display:"block"}),$(".v_QA").css({display:"none"})})});